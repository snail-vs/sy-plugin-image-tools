(()=>{"use strict";var e={237:(e,t,i)=>{const n=i(485);class a extends n.Plugin{constructor(){super(...arguments),this.currentImage=null,this.floatPanel=null,this.previewPanel=null}async onload(){this.initFloatPanel(),this.initPreviewPanel(),this.bindEvents()}initFloatPanel(){this.floatPanel=document.createElement("div"),this.floatPanel.className="image-operations-float-panel",this.floatPanel.innerHTML='\n      <div class="image-operations-toolbar">\n        <button class="image-operations-button" id="rotate-left" title="ÈÄÜÊó∂ÈíàÊóãËΩ¨">\n          ‚Ü∫\n        </button>\n        <button class="image-operations-button" id="rotate-right" title="È°∫Êó∂ÈíàÊóãËΩ¨">\n          ‚Üª\n        </button>\n        <button class="image-operations-button" id="preview" title="È¢ÑËßàÂõæÁâá">\n          üîç\n        </button>\n        <button class="image-operations-button" id="save" title="‰øùÂ≠òÂõæÁâá">\n          üíæ\n        </button>\n      </div>\n    ',document.body.appendChild(this.floatPanel),this.bindFloatPanelEvents()}initPreviewPanel(){this.previewPanel=document.createElement("div"),this.previewPanel.className="image-operations-preview-panel",this.previewPanel.innerHTML='\n      <div class="image-operations-preview-overlay"></div>\n      <div class="image-operations-preview-content">\n        <div class="image-operations-preview-header">\n          <button class="image-operations-preview-close" id="preview-close">√ó</button>\n        </div>\n        <div class="image-operations-preview-body">\n          <img id="preview-image" src="" alt="Preview" />\n        </div>\n      </div>\n    ',document.body.appendChild(this.previewPanel),this.bindPreviewPanelEvents()}bindFloatPanelEvents(){this.floatPanel.querySelector("#rotate-left").addEventListener("click",()=>{this.rotateImage(-90)}),this.floatPanel.querySelector("#rotate-right").addEventListener("click",()=>{this.rotateImage(90)}),this.floatPanel.querySelector("#preview").addEventListener("click",()=>{this.showPreview()}),this.floatPanel.querySelector("#save").addEventListener("click",()=>{this.saveImage()})}bindPreviewPanelEvents(){this.previewPanel.querySelector("#preview-close").addEventListener("click",()=>{this.hidePreview()}),this.previewPanel.querySelector(".image-operations-preview-overlay").addEventListener("click",()=>{this.hidePreview()})}bindEvents(){document.addEventListener("click",e=>{const t=e.target;"IMG"===t.tagName?(e.preventDefault(),e.stopPropagation(),this.showFloatPanel(t,e.clientX,e.clientY)):this.hideFloatPanel()})}showFloatPanel(e,t,i){this.currentImage=e,this.floatPanel.style.left=`${t}px`,this.floatPanel.style.top=`${i}px`,this.floatPanel.style.display="block"}hideFloatPanel(){this.floatPanel.style.display="none",this.currentImage=null}showPreview(){if(!this.currentImage)return;this.previewPanel.querySelector("#preview-image").src=this.currentImage.src,this.previewPanel.style.display="block"}hidePreview(){this.previewPanel.style.display="none"}rotateImage(e){if(!this.currentImage)return;let t=(parseInt(this.currentImage.dataset.rotate||"0")+e)%360;t<0&&(t+=360),this.currentImage.style.transform=`rotate(${t}deg)`,this.currentImage.dataset.rotate=t;const i=this.previewPanel.querySelector("#preview-image");i.src===this.currentImage.src&&"block"===this.previewPanel.style.display&&(i.style.transform=`rotate(${t}deg)`,i.dataset.rotate=t)}saveImage(){if(!this.currentImage)return;const e=this.currentImage,t=parseInt(e.dataset.rotate||"0"),i=document.createElement("canvas"),n=i.getContext("2d"),a=new Image;a.crossOrigin="anonymous",a.onload=()=>{90===t||270===t?(i.width=a.height,i.height=a.width):(i.width=a.width,i.height=a.height),n.save(),n.translate(i.width/2,i.height/2),n.rotate(t*Math.PI/180),n.drawImage(a,-a.width/2,-a.height/2),n.restore(),i.toBlob(t=>{if(t){const i=URL.createObjectURL(t),n=document.createElement("a");n.href=i,n.download=this.getFileNameFromUrl(e.src),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(i)}},"image/png")},a.src=e.src}getFileNameFromUrl(e){const t=e.split("/");let i=t[t.length-1];const n=i.indexOf("?");n>-1&&(i=i.substring(0,n));const a=i.indexOf("#");return a>-1&&(i=i.substring(0,a)),i}onunload(){this.floatPanel&&document.body.removeChild(this.floatPanel),this.previewPanel&&document.body.removeChild(this.previewPanel)}}e.exports=a},485:e=>{e.exports=require("siyuan")}},t={};(function i(n){var a=t[n];if(void 0!==a)return a.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,i),r.exports})(237)})();